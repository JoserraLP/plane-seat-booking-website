{% extends "base.html" %}

{% block content %}
{% with messages = get_flashed_messages() %}
{% if messages %}
<div class="notification is-danger">
    {{ messages[0] }}
</div>
{% else %}
<h1>Available planes</h1>
{% if planes %}

{% for item in planes %}
<div class="row">
    {% if planes[item]['full'] %}
    <div class="col bg-gray mt-3 mb-3 ml-5 mr-5 p-2">
        {% else %}
        <div class="col bg-light-green mt-3 mb-3 ml-5 mr-5 p-2" data-id="{{planes[item]['name'] }}"
             onclick="showSeats(this)">
            {% endif %}
            <div class="row">
                <div class="pt-3 text-center">{{planes[item]['name'] }}</div>
                <div class="pt-3 text-center">From: {{planes[item]['from'] }}</div>
                <div class="pt-3 text-center">To: {{planes[item]['to'] }}</div>
                <div class="pt-3 text-center">Day: {{planes[item]['days'] }}</div>
            </div>
        </div>
    </div>
    {% endfor %}

    {% else %}
    <p class="pt-5 mt-5"> Planes cannot be loaded, please refresh the page</p>
    {% endif %}
    {% endif %}
    {% endwith %}
    <!-- Hidden modal dialog -->
    <!-- Modal -->
    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form action="{{url_for('planes.book_details')}}" method="POST">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        ...
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <input class="btn btn-dark" type="submit" value="Book seats">
                    </div>
                </form>
            </div>
        </div>
    </div>

    {% block javascript %}
    <script>

var data = {{ planes | tojson }};

function showSeats(elem)
{
  var plane_name = elem.getAttribute("data-id");
  plane_name = "planes:"+plane_name.slice(-1);
  var seats = data[plane_name]['seats'];
  console.log(data);

    $('.modal-header').empty();
    $('.modal-header').html(data[plane_name]['name']);
    $('.modal-body').empty(); // clear the body of any old content
    var container = document.createElement('div');
    container.classList.add('container');
    $('.modal-body').append(container);

    var total_seats = Object.keys(seats).length;

    for (var i=0; i < total_seats; i+=4){
        var row = document.createElement('div');
        row.classList.add('row');
        container.appendChild(row);

        if (i < total_seats){
            var col_1 = document.createElement('div');
            col_1.className += ('col mt-1 mb-1 ml-2 mr-2');
            var p = document.createElement('p');
            p.innerHTML = i;

            var input = document.createElement('input');
            input.type = "checkbox";
            input.name = "seats";
            input.value = plane_name + "_" + i;

            if (seats[i] == "")
                col_1.className += " bg-light-green";
            else if (seats[i] == "locked") {
                col_1.className += " bg-warning";
                input.disabled = true;
            }else{
                col_1.className += " bg-gray";
                input.disabled = true;
            }

            row.appendChild(col_1);

            col_1.appendChild(input);
            col_1.appendChild(p);

        }

        // TODO meter con las 4 columnas, copiar y pegar cambiando el col
    }

    $('.modal-body').append(container);

    $('#modal').modal('show');
}




    </script>
    {% endblock %}

    {% endblock %}